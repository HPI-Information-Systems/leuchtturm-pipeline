image: python:3.6

cache:
  paths:
    - .pip

stages:
  - test_and_lint
  - codequality

test:
  stage: test_and_lint
  script:
    - mkdir -p .pip
    - pip install -U pip
    - pip --cache-dir=.pip install -r requirements.txt
    - flake8 .

lint:
  stage: test_and_lint
  script:
    - mkdir -p .pip
    - pip install -U pip
    - pip --cache-dir=.pip install -r requirements.txt
    - pytest

codequality:
  image: coala/base
  stage: codequality
  script:
    - echo "Find complex methods..."
    - coala -I --ci --files=\*\*/\*.py --bears=RadonBear
    - echo "Find duplicated code..."
    - coala -I --ci --files=\*\*/\*.py --bears=CPDBear
    - echo "Find commented code..."
    - coala -I --ci --files=\*\*/\*.py --bears=PyCommentedCodeBear
    - echo "Validate order od imports..."
    - coala -I --ci --files=\*\*/\*.py --bears=PyImportSortBear
    - echo "Check vulnarable packages in requirements..."
    - coala -I --ci --files=\*\*/\*.py --bears=PySafetyBear
    - echo "Validate file naming..."
    - coala -I --ci --files=\*\*/\*.py --bears=PyUnusedCodeBear
    - echo "Detect unused variables..."
    - coala -I --ci --files=\*\*/\*.py --bears=VultureBear
    - echo "Validate file naming..."
    - coala -I --ci --files=\*\*/\*.py --bears=FilenameBear
